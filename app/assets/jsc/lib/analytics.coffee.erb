# Noted
#   file: lib/analytics.coffee.erb

# Google Analytics
((i, s, o, g, r, a, m) ->
  i["GoogleAnalyticsObject"] = r
  i[r] = i[r] or ->
    (i[r].q = i[r].q or []).push arguments_
    return

  i[r].l = 1 * new Date()

  a = s.createElement(o)
  m = s.getElementsByTagName(o)[0]

  a.async = 1
  a.src = g
  m.parentNode.insertBefore a, m
  return
) window, document, "script", "//www.google-analytics.com/analytics.js", "ga"
ga "create", "<%= ENV['GOOGLE_ANALYTICS'] %>", "getnoted.org"
ga "send", "pageview"

# Segment.io
window.analytics or (window.analytics = [])
window.analytics.methods = [
  "identify"
  "track"
  "trackLink"
  "trackForm"
  "trackClick"
  "trackSubmit"
  "page"
  "pageview"
  "ab"
  "alias"
  "ready"
  "group"
  "on"
  "once"
  "off"
]
window.analytics.factory = (t) ->
  ->
    a = Array::slice.call(arguments_)
    a.unshift(t)
    window.analytics.push(a)
    window.analytics


i = 0

while window.analytics.methods.length > i
  method = window.analytics.methods[i]
  window.analytics[method] = window.analytics.factory(method)
  i++
window.analytics.load = (t) ->
  a = document.createElement("script")
  a.type = "text/javascript"
  a.async = not 0
  a.src = ((if "https:" is document.location.protocol then "https://" else "http://")) + "d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/" + t + "/analytics.min.js"

  n = document.getElementsByTagName("script")[0]
  n.parentNode.insertBefore a, n
  return

window.analytics.SNIPPET_VERSION = "2.0.8"
window.analytics.load("<%= ENV['SEGMENT_IO'] %>")

window.analytics.page()
